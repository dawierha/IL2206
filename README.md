# IL2206 Embedded Systems Laboratory

This repository contains the source files needed to get started with the IL2206 lab. You need to acquire them in one of the following way:

 * download a `.zip` archive by clicking _Clone or download_ -> _Download ZIP_. 
 * create an own repository and attach a remote to this one as presented in the [instructions on the course home page](https://kth.instructure.com/courses/6446/pages/setting-up-a-git-repositorty). 

## Contents 

This repository is organized as follows:

 * `app` contains source files for the lab applications, grouped in subfolders by project. It also contains a `Makefile` which is a build automation script for helping with the lab tasks. 
 * `bsp` is an empty folder which might contain the generated Board Support Packages for different configurations in case you are using our build scripts.
 * `hardware` contains files describing the pre-built hardware cores. 

### Choosing a work style

Unless specifically stated, the instructions in the lab manuals do not impose what tools to use in order to write an application and deliver any specific task. In this sense you have two alternatives to choose from:

 * use (mainly) the Eclipse IDE provided by Altera with its associated GUI tools. In this case the work flow is documented in the [Nios2 Eclipse Tutorial](https://www.intel.com/content/dam/altera-www/global/en_US/pdfs/literature/tt/tt_my_first_nios_sw.pdf) and you mainly need only the source files, which can be copied and included in your IDE projects. Thus you will be interested ***only** in the following files, ignoring the rest:
   - the source files (`.c`, `.h` or `.s`) found in `app/<project>/src/`
   - the pre-built hardware files found in `hardware/<your-board>/`
 * use your favorite code editor and use CLI tools for performing the tasks. In this case we have provided a bunch of automation scripts which can be used "as-is" or as inspiration for your own automation flow. We recommend that you go through the [Nios2 CLI tutorial](https://www.intel.com/content/dam/altera-www/global/en_US/pdfs/literature/hb/nios2/n2sw_nii52014.pdf) 

## Using our automation scripts

If you prefer the second work style from those presented above, this repository is organized is such a way that you can easily get started. However, in order to make use of the automation scripts you need to follow some recommandations:

 * all commands need to be run from the **Nios 2 Shell**, since a normal terminal shell will not know where the Altera tools are located.
 * the `app` folder is the place you will spend most time in. It needs to contain _one subfolder per project_, each subfolder containing only source files (e.g. `.c`, `.h` or `.s`). One or multiple configuration file(s) can also be found here. The configuration file needs to define a set of variables without which the main automation script at `app/Makefile` cannot run. 
 * the build script can be used by calling the command `make` followed by arguments, from the `app` folder. But before the first use, you need to configure it to target one specific application, e.g.:

        cd path/to/il2206-lab/app
        make config CFG=lab1-io/configuration

 * take some time to study what the `Makefile` does by reading it in a code editor. While not mandatory, some [basic knowledge of GNU Make](http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/) is useful. This script is extensively documented in-line, so it should not be too difficult to follow which commands it invokes and which flags it uses. Also, you can check which arguments it accepts by typing:

        make help

 * test the build script with the sources provided in the first lab with the commands below. Check what intermediate files are generated.

        cd path/to/il2206-lab/app
        make config CFG=lab1-io/configuration
        make compile
        make run

 * the `bsp` folder contains the BSP libraries generated by the Altera tools. Each subfolder is corresponding to a different system configuration. It is referenced from within the `configuration` files associated with each project, and a new BSP can be created by referencing a new path in the configuration currently executed.
 * the `hardware` folder contains resources associated with the Nios2 hardware systems. It does not really matter how it is organized internally, because only the important files will be referenced with their full path from any appication `configuration` file. Here you can host your Quartus/Qsys projects.
 * _(Git users only)_ make sure you make use of [`.gitignore`](https://www.atlassian.com/git/tutorials/saving-changes/gitignore) files so that you do not commit (unnecessary) generated files. You should only commit source files. 


